# Лабораторная работа. Настройка и проверка расширенных списков контроля доступа.

## Топология

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11Topology.PNG)

## Таблица адресации.

| Уст-во  | Интерфейс  | IP  | Маска  | Шлюз по умолчанию  |
|---|---|---|---|---|
| R1  | G0/0/1  | NA  | 255.255.255.0  | NA  |
| R1  | G0/0/1.20  | 10.20.0.1  | 255.255.255.0  | NA  |
| R1  | G0/0/1.30  | 10.30.0.1  | 255.255.255.0  | NA  |
| R1  | G0/0/1.40  | 10.40.0.1  | 255.255.255.0  | NA  |
| R1  | G0/0/1.1000  | NA  | 255.255.255.0  | NA  |
| R1  | Loopback1  | 172.16.1.1  | 255.255.255.0  | NA  |
| R2  | G0/0/1  | 10.20.0.4  | 255.255.255.0  | NA  |
| S1  | VLAN 20  | 10.20.0.2  | 255.255.255.0  | 10.20.0.1  |
| S2  | VLAN 20  | 10.20.0.3  | 255.255.255.0  | 10.20.0.1  |
| PC-A  | NIC  | 10.30.0.10  | 255.255.255.0  | 10.30.0.1  |
| PC-B  | NIC  | 10.40.0.10  | 255.255.255.0  | 10.40.0.1  |

## Таблица VLAN:

| vlan  | Имя  | Интерфейсы  |
|---|---|---|
| 20  | Managment  | S2: F0/5  |
| 30  | Operation  | S1: F0/6  |
| 40  | Sales  | S2: F0/18  |
| 999  | Parking_Lot  | S1: F0/2-4, F0/7-24, G0/1-2 ; S2: F0/2-4, F0/6-17, F0/19-24, G0/1-2  |
| 1000  | Native  | NA  |


## Задачи:
Часть 1. Создание сети и настройка основных параметров устройства
Часть 2. Настройка и проверка списков расширенного контроля доступа

### Часть 1. Создание сети и настройка основных параметров устройства
Используем всё те же знания, что и раньше и настраиваем базово коммутаторы и роутеры.

### Часть 2. Настройка сетей VLAN на коммутаторах
#### Шаг 1. Создайте сети VLAN на коммутаторах.

- a.	Создайте необходимые VLAN и назовите их на каждом коммутаторе из приведенной выше таблицы.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2VLANS.PNG)

- b.	Настройте интерфейс управления и шлюз по умолчанию на каждом коммутаторе, используя информацию об IP-адресе в таблице адресации.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2VLANSint.PNG)

- c.	Назначьте все неиспользуемые порты коммутатора VLAN Parking Lot, настройте их для статического режима доступа и административно деактивируйте их.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2VLANShut.PNG)


#### Шаг 2. Назначьте сети VLAN соответствующим интерфейсам коммутатора.
- a.	Назначьте используемые порты соответствующей VLAN (указанной в таблице VLAN выше) и настройте их для режима статического доступа.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2VLANSintmain.PNG)

- b.	Выполните команду show vlan brief, чтобы убедиться, что сети VLAN назначены правильным интерфейсам.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2VLANbrief.PNG)


### Часть 3. ·Настройте транки (магистральные каналы).
#### Шаг 1. Вручную настройте магистральный интерфейс F0/1.

- a.	Измените режим порта коммутатора на интерфейсе F0/1, чтобы принудительно создать магистральную связь. Не забудьте сделать это на обоих коммутаторах.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2Trunk.PNG)

- b.	В рамках конфигурации транка установите для native vlan значение 1000 на обоих коммутаторах. При настройке двух интерфейсов для разных собственных VLAN сообщения об ошибках могут отображаться временно.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2Trunk1.PNG)

- c.	В качестве другой части конфигурации транка укажите, что VLAN 10, 20, 30 и 1000 разрешены в транке.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2Trunk2.PNG)

- d.	Выполните команду show interfaces trunk для проверки портов магистрали, собственной VLAN и разрешенных VLAN через магистраль.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1S2Trunk3.PNG)


####Шаг 2. Вручную настройте магистральный интерфейс F0/5 на коммутаторе S1.
- a.	Настройте интерфейс S1 F0/5 с теми же параметрами транка, что и F0/1. Это транк до маршрутизатора.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11S1TrunkAllowed.PNG)

- c.	Используйте команду show interfaces trunk для проверки настроек транка.

### Часть 4. Настройте маршрутизацию.
#### Шаг 1. Настройка маршрутизации между сетями VLAN на R1.

- a.	Активируйте интерфейс G0/0/1 на маршрутизаторе.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1G01nosh.PNG)

- b.	Настройте подинтерфейсы для каждой VLAN, как указано в таблице IP-адресации. Все подинтерфейсы используют инкапсуляцию 802.1Q. Убедитесь, что подинтерфейс для собственной VLAN не имеет назначенного IP-адреса. Включите описание для каждого подинтерфейса.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1Vlan.PNG)

- c.	Настройте интерфейс Loopback 1 на R1 с адресацией из приведенной выше таблицы.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1Loopback.PNG)

- d.	С помощью команды show ip interface brief проверьте конфигурацию подынтерфейса.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1showIPbrief.PNG)

####Шаг 2. Настройка интерфейса R2 g0/0/1 с использованием адреса из таблицы и маршрута по умолчанию с адресом следующего перехода 10.20.0.1

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R2Conf.PNG)


### Часть 5. Настройте удаленный доступ
### Шаг 1. Настройте все сетевые устройства для базовой поддержки SSH.

- a.	Создайте локального пользователя с именем пользователя SSHadmin и зашифрованным паролем $cisco123!
- b.	Используйте ccna-lab.com в качестве доменного имени.
- c.	Генерируйте криптоключи с помощью 1024 битного модуля.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1User.PNG)

- d.	Настройте первые пять линий VTY на каждом устройстве, чтобы поддерживать только SSH-соединения и с локальной аутентификацией.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1vty.PNG)

#### Шаг 2. Включите защищенные веб-службы с проверкой подлинности на R1.
- a.	Включите сервер HTTPS на R1.
R1(config)# ip http secure-server

К сожалению, CPT не обладает данной функцией. Поэтому не совсем ясно, как сделать в обход. 

- b.	Настройте R1 для проверки подлинности пользователей, пытающихся подключиться к веб-серверу.
R1(config)# ip http authentication local


Часть 6. Проверка подключения
#### Шаг 1. Настройте узлы ПК.
#### Шаг 2. Выполните следующие тесты. Эхозапрос должен пройти успешно.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCAPing.PNG)

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCBPing.PNG)

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCBSSH1.PNG)

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCBSSH0.PNG)

### Часть 7. Настройка и проверка списков контроля доступа (ACL)

При проверке базового подключения компания требует реализации следующих политик безопасности:
 - Политика 1. Сеть Sales не может использовать SSH в сети Management (но в  другие сети SSH разрешен). 
 - Политика 2. Сеть Sales не имеет доступа к IP-адресам в сети Management с помощью любого веб-протокола (HTTP/HTTPS). Сеть Sales также не имеет доступа к интерфейсам R1 с помощью любого веб-протокола. Разрешён весь другой веб-трафик (обратите внимание — Сеть Sales  может получить доступ к интерфейсу Loopback 1 на R1).
 - Политика3. Сеть Sales не может отправлять эхо-запросы ICMP в сети Operations или Management. Разрешены эхо-запросы ICMP к другим адресатам. 
 - Политика 4: Cеть Operations  не может отправлять ICMP эхозапросы в сеть Sales. Разрешены эхо-запросы ICMP к другим адресатам. 

#### Шаг 1. Проанализируйте требования к сети и политике безопасности для планирования реализации ACL.
#### Шаг 2. Разработка и применение расширенных списков доступа, которые будут соответствовать требованиям политики безопасности.

Перечисленные выше требования требуют реализации двух списков расширенного доступа. Так как списки должны находиться как можно ближе к узлу, то эти списки будут доступны на интерфейсах G0/0/ 0.30 и G0/ 0 /0.40

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11R1ACL.PNG)
 
#### Шаг 3. Убедитесь, что политики безопасности применяются развернутыми списками доступа.

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCAPingACL.PNG)

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCBPingACL.PNG)

![](https://github.com/Despirant/Desp_Labs/blob/main/pics/Labs11PCBSSH2.PNG)


