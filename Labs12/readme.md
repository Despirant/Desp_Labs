# Лабораторная работа. Настройка NAT для IPv4

## Топология



## Таблица адресации

| Уст-во  | Интерфейс  | IP  | Маска  |
|---|---|---|---|
| R1  | g0/0/0  | 209.165.200.230  | 255.255.255.248  |
|   | g0/0/1  | 192.168.1.1  | 255.255.255.0  |
| R2  | g0/0/0  | 209.165.200.225  | 255.255.255.248  |
|   | Loopback  | 209.165.200.1  | 255.255.255.224  |
| S1  | vlan 1  | 192.168.1.11  | 255.255.255.0  |
| S2  | vlan 1  | 192.168.1.12  | 255.255.255.0  |
| PC-A  | nic  | 192.168.1.2  | 255.255.255.0  |
| PC-B  | nic  | 192.168.1.3  | 255.255.255.0  |

## Цели
- Часть 1. Создание сети и настройка основных параметров устройства
- Часть 2. Настройка и проверка NAT для IPv4
- Часть 3. Настройка и проверка PAT для IPv4
- Часть 4. Настройка и проверка статического NAT для IPv4.

### Часть 1. Создание сети и настройка основных параметров устройства
Создаём в CPT сеть и настраиваем базовые настройки роутеров и коммутаторов

## Часть 2. Настройка и проверка NAT для IPv4.

Шаг 1. Настройте NAT на R1, используя пул из трех адресов 209.165.200.226-209.165.200.228. 

 - a.	Настройте простой список доступа, который определяет, какие хосты будут разрешены для трансляции. В этом случае все устройства в локальной сети R1 имеют право на трансляцию.



 - b.	Создайте пул NAT и укажите ему имя и диапазон используемых адресов.



 - c.	Настройте перевод, связывая ACL и пул с процессом преобразования.



 - d.	Задайте внутренний (inside) интерфейс. 



#### Шаг 2. Проверьте и проверьте конфигурацию. 
 - a.	С PC-B,  запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните процес поиска и устранения неполадок. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.




#### Вопросы:
Во что был транслирован внутренний локальный адрес PC-B?
Введите ваш ответ здесь.
 
Какой тип адреса NAT является переведенным адресом?
 
 - b.	С PC-A, запустите  эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.




 - c.	Обратите внимание, что предыдущая трансляция для PC-B все еще находится в таблице. Из S1, эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.




 - d.	Теперь запускаем пинг R2 Lo1 из S2. На этот раз перевод завершается неудачей, и вы получаете эти сообщения (или аналогичные) на консоли R1:




 - e.	Это ожидаемый результат, потому что выделено только 3 адреса, и мы попытались ping Lo1 с четырех устройств. Напомним, что NAT — это трансляция «один-в-один». Как много выделено трансляций? Введите команду show ip nat translations verbose , и вы увидите, что ответ будет 24 часа.



Шаг 1. Удалите команду преобразования на R1.



#### Шаг 2. Добавьте команду PAT на R1.



#### Шаг 3. Протестируйте и проверьте конфигурацию.
 - a.	Давайте проверим, что PAT работает. С PC-B,  запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды




#### Вопросы:
Во что был транслирован внутренний локальный адрес PC-B?
 
Какой тип адреса NAT является переведенным адресом?

 
Чем отличаются выходные данные команды show ip nat translations из упражнения NAT?


 
 - b.	С PC-A, запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.




 - c.	Генерирует трафик с нескольких устройств для наблюдения PAT. На PC-A и PC-B используйте параметр -t с командой ping, чтобы отправить безостановочный ping на интерфейс Lo1 R2 (ping -t 209.165.200.1), затем вернитесь к R1 и выполните команду show ip nat translations:




Вопрос:
Как маршрутизатор отслеживает, куда идут ответы? 
 
 - d.	PAT в пул является очень эффективным решением для малых и средних организаций. Тем не менее есть неиспользуемые адреса IPv4, задействованные в этом сценарии. Мы перейдем к PAT с перегрузкой интерфейса, чтобы устранить эту трату IPv4 адресов. Остановите ping на PC-A и PC-B с помощью комбинации клавиш Control-C, затем очистите трансляции и статистику:

#### Шаг 4. На R1 удалите команды преобразования nat pool.



#### Шаг 5. Добавьте команду PAT overload, указав внешний интерфейс.



#### Шаг 6. Протестируйте и проверьте конфигурацию. 
 - a.	Давайте проверим PAT, чтобы интерфейс работал. С PC-B,  запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.




 - b.	Сделайте трафик с нескольких устройств для наблюдения PAT. На PC-A и PC-B используйте параметр -t с командой ping для отправки безостановочного ping на интерфейс Lo1 R2 (ping -t 209.165.200.1). На S1 и S2 выполните привилегированную команду exec ping 209.165.200.1 повторить 2000. Затем вернитесь к R1 и выполните команду show ip nat translations.




Теперь все внутренние глобальные адреса сопоставляются с IP-адресом интерфейса g0/0/0.

### Часть 4. Настройка и проверка статического NAT для IPv4.

#### Шаг 1. На R1 очистите текущие трансляции и статистику.



 
#### Шаг 2. На R1 настройте команду NAT, необходимую для статического сопоставления внутреннего адреса с внешним адресом.



#### Шаг 3. Протестируйте и проверьте конфигурацию.
 - a.	Давайте проверим, что статический NAT работает. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations, и вы увидите статическое сопоставление.




 - b.	Таблица перевода показывает, что статическое преобразование действует. Проверьте это, запустив ping  с R2 на 209.165.200.229. Плинги должны работать.
Примечание. Возможно, вам придется отключить брандмауэр ПК для работы pings.
 - c.	На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations, и вы увидите статическое сопоставление и преобразование на уровне порта для входящих pings.



Это подтверждает, что статический NAT работает.
